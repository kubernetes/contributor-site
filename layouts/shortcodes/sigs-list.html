{{- $sigsDataSourceUrl := "https://raw.githubusercontent.com/kubernetes/community/master/sigs.yaml" -}}
{{- $sigsData := "" -}}
{{- with resources.GetRemote $sigsDataSourceUrl -}}
  {{- if .Err -}}
    {{- warnf "Unable to load SIGs data: %s" .Err -}}
  {{- else -}}
    {{- $sigsData = .Content | transform.Unmarshal -}}
  {{- end -}}
{{- end -}}

{{ if $sigsData }}
<div class="sigs-container my-5">
  <div class="row">
    <!-- Sidebar Navigation -->
    <div class="col-md-3 mb-4 sticky-md-top" style="top: 2rem; height: fit-content;">
      <div class="nav flex-column nav-pills shadow-sm rounded bg-white p-2 border" id="sigsTab" role="tablist" aria-orientation="vertical">
        <button class="nav-link active text-start mb-2 d-flex justify-content-between align-items-center" id="sigs-tab" data-bs-toggle="pill" data-bs-target="#sigs" type="button" role="tab" aria-controls="sigs" aria-selected="true">
          <span><i class="fas fa-users-cog me-2"></i> SIGs</span>
          <span class="badge rounded-pill bg-primary">{{ len $sigsData.sigs }}</span>
        </button>
        <button class="nav-link text-start mb-2 d-flex justify-content-between align-items-center" id="wg-tab" data-bs-toggle="pill" data-bs-target="#wg" type="button" role="tab" aria-controls="wg" aria-selected="false">
          <span><i class="fas fa-project-diagram me-2"></i> Working Groups</span>
          <span class="badge rounded-pill bg-success">{{ len $sigsData.workinggroups }}</span>
        </button>
        {{ if $sigsData.usergroups }}
        <button class="nav-link text-start mb-2 d-flex justify-content-between align-items-center" id="ug-tab" data-bs-toggle="pill" data-bs-target="#ug" type="button" role="tab" aria-controls="ug" aria-selected="false">
          <span><i class="fas fa-users me-2"></i> User Groups</span>
          <span class="badge rounded-pill bg-info">{{ len $sigsData.usergroups }}</span>
        </button>
        {{ end }}
        <button class="nav-link text-start d-flex justify-content-between align-items-center" id="committees-tab" data-bs-toggle="pill" data-bs-target="#committees" type="button" role="tab" aria-controls="committees" aria-selected="false">
          <span><i class="fas fa-shield-alt me-2"></i> Committees</span>
          <span class="badge rounded-pill bg-warning text-dark">{{ len $sigsData.committees }}</span>
        </button>
      </div>
      
      <div class="mt-4">
        <div class="card bg-light border-0 shadow-sm">
          <div class="card-body p-3 text-center">
             <div class="fw-bold small text-uppercase mb-2">Meeting Resources</div>
             <div class="d-flex justify-content-around">
               <span title="Live Meeting Link"><i class="fas fa-video text-primary fa-lg"></i></span>
               <span title="Meeting Notes"><i class="fas fa-file-alt text-secondary fa-lg"></i></span>
               <span title="YouTube Recordings"><i class="fab fa-youtube text-danger fa-lg"></i></span>
             </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Content Area -->
    <div class="col-md-9">
      <!-- Filters Row -->
      <div class="row g-2 mb-4">
        <div class="col-md-8">
          <div class="input-group shadow-sm border rounded">
            <span class="input-group-text bg-white border-0"><i class="fas fa-search text-muted"></i></span>
            <input type="text" id="sigSearchInput" class="form-control border-0 py-2" placeholder="Search by name or description..." aria-label="Search SIGs">
          </div>
        </div>
        <div class="col-md-4">
          <select id="dayFilter" class="form-select border shadow-sm py-2" aria-label="Filter by day">
            <option value="">All Meeting Days</option>
            <option value="monday">Monday</option>
            <option value="tuesday">Tuesday</option>
            <option value="wednesday">Wednesday</option>
            <option value="thursday">Thursday</option>
            <option value="friday">Friday</option>
          </select>
        </div>
      </div>

      <div class="tab-content" id="sigsTabContent">
        <!-- SIGs Pane -->
        <div class="tab-pane fade show active" id="sigs" role="tabpanel" aria-labelledby="sigs-tab">
          <div class="row g-4" id="sigsGrid">
            {{ range sort $sigsData.sigs "name" }}
            {{ $meetings := .meetings }}
            {{ $meetingDays := "" }}
            {{ range $meetings }}{{ $meetingDays = printf "%s %s" $meetingDays (.day | lower) }}{{ end }}
            <div class="col-xl-6 sig-card-wrapper" 
                 data-name="{{ .name | lower }}" 
                 data-description="{{ .mission_statement | lower }}" 
                 data-label="{{ .label | lower }}"
                 data-days="{{ $meetingDays }}">
              <div class="card h-100 border-0 shadow-sm transition-hover border-top border-primary border-4">
                <div class="card-body d-flex flex-column p-4">
                  <div class="d-flex justify-content-between align-items-start mb-3">
                    <h5 class="fw-bold mb-0 text-primary">SIG {{ .name }}</h5>
                    <a href="https://github.com/kubernetes/community/tree/master/{{ .dir }}" class="text-muted" title="View Source"><i class="fab fa-github"></i></a>
                  </div>
                  
                  <p class="card-text text-secondary mb-4 flex-grow-1">{{ .mission_statement | markdownify }}</p>
                  
                  {{ if .leadership }}
                  <div class="mb-4">
                    <h6 class="fw-bold small text-uppercase text-muted border-bottom pb-1 mb-2">Chairs & Leads</h6>
                    <div class="d-flex flex-wrap gap-2">
                      {{ range .leadership.chairs }}
                      <a href="https://github.com/{{ .github }}" class="badge bg-github-handle text-decoration-none py-2 px-3">
                        <i class="fab fa-github me-1"></i> @{{ .github }}
                      </a>
                      {{ end }}
                    </div>
                  </div>
                  {{ end }}

                  {{ if .meetings }}
                  <div class="bg-light p-3 rounded-3">
                    <h6 class="fw-bold small text-uppercase text-muted mb-2"><i class="far fa-clock me-1"></i> Meetings (All)</h6>
                    {{ range .meetings }}
                    <div class="mb-2 last-child-no-margin border-bottom border-white pb-2 last-child-no-border">
                      <div class="d-flex justify-content-between align-items-start mb-1">
                        <div class="fw-bold small">{{ .description }}</div>
                        <div class="d-flex gap-2">
                          {{ if .url }}
                          <a href="{{ .url }}" target="_blank" class="text-primary" title="Join Meeting">
                            <i class="fas fa-video"></i>
                          </a>
                          {{ end }}
                          {{ if .archive_url }}
                          <a href="{{ .archive_url }}" target="_blank" class="text-secondary" title="Meeting Notes">
                            <i class="fas fa-file-alt"></i>
                          </a>
                          {{ end }}
                          {{ if .recordings_url }}
                          <a href="{{ .recordings_url }}" target="_blank" class="text-danger" title="YouTube Recordings">
                            <i class="fab fa-youtube"></i>
                          </a>
                          {{ end }}
                        </div>
                      </div>
                      <div class="small text-dark">
                        {{ .day }} at 
                        <span class="fw-bold">
                          {{ .time }} {{ .tz }}
                          {{ if or (strings.Contains .tz "PT") (strings.Contains .tz "Pacific") }}
                             / 
                             {{ $t := split .time ":" }}
                             {{ $h_str := index $t 0 }}
                             {{ $h := int (strings.TrimLeft "0" $h_str | default "0") }}
                             {{ $m := index $t 1 }}
                             {{ $et_h := add $h 3 }}
                             {{ if ge $et_h 24 }}{{ $et_h = sub $et_h 24 }}{{ end }}
                             {{ printf "%02d:%s" $et_h $m }} ET
                          {{ end }}
                        </span>
                      </div>
                    </div>
                    {{ end }}
                  </div>
                  {{ end }}
                  
                  <div class="mt-4 d-flex gap-2">
                    <a href="https://slack.k8s.io" class="btn btn-sm btn-outline-info rounded-pill px-3">#sig-{{ .label }}</a>
                  </div>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
        
        <!-- Working Groups -->
        <div class="tab-pane fade" id="wg" role="tabpanel" aria-labelledby="wg-tab">
          <div class="row g-4" id="wgGrid">
            {{ range sort $sigsData.workinggroups "name" }}
            {{ $meetings := .meetings }}
            {{ $meetingDays := "" }}
            {{ range $meetings }}{{ $meetingDays = printf "%s %s" $meetingDays (.day | lower) }}{{ end }}
            <div class="col-xl-6 sig-card-wrapper" 
                 data-name="{{ .name | lower }}" 
                 data-description="{{ .mission_statement | lower }}"
                 data-days="{{ $meetingDays }}">
              <div class="card h-100 border-0 shadow-sm border-top border-success border-4">
                <div class="card-body p-4 d-flex flex-column">
                  <h5 class="fw-bold text-success mb-3">WG {{ .name }}</h5>
                  <p class="card-text text-secondary mb-4 flex-grow-1">{{ .mission_statement | markdownify }}</p>
                  
                  {{ if .meetings }}
                  <div class="bg-light p-3 rounded-3 mb-4">
                    <h6 class="fw-bold small text-uppercase text-muted mb-2">Meetings</h6>
                    {{ range .meetings }}
                    <div class="small text-dark mb-1">
                       <span class="fw-bold">{{ .day }}:</span> {{ .time }} {{ .tz }}
                    </div>
                    {{ end }}
                  </div>
                  {{ end }}
                  
                  <a href="https://github.com/kubernetes/community/tree/master/{{ .dir }}" class="btn btn-sm btn-success text-white rounded-pill px-4 align-self-start mt-auto">View Group</a>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>

        <!-- Committees -->
        <div class="tab-pane fade" id="committees" role="tabpanel" aria-labelledby="committees-tab">
          <div class="row g-4" id="committeesGrid">
            {{ range sort $sigsData.committees "name" }}
            <div class="col-xl-6 sig-card-wrapper" data-name="{{ .name | lower }}" data-description="{{ .mission_statement | lower }}">
              <div class="card h-100 border-0 shadow-sm border-top border-warning border-4">
                <div class="card-body p-4 d-flex flex-column">
                  <h5 class="fw-bold text-warning mb-3">{{ .name }}</h5>
                  <p class="card-text text-secondary mb-4 flex-grow-1">{{ .mission_statement | markdownify }}</p>
                  <a href="https://github.com/kubernetes/community/tree/master/{{ .dir }}" class="btn btn-sm btn-warning text-dark fw-bold rounded-pill px-4 align-self-start mt-auto">View Details</a>
                </div>
              </div>
            </div>
            {{ end }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('sigSearchInput');
  const dayFilter = document.getElementById('dayFilter');
  const cardWrappers = document.querySelectorAll('.sig-card-wrapper');
  
  function applyFilters() {
    const searchTerm = searchInput.value.toLowerCase().trim();
    const dayTerm = dayFilter.value.toLowerCase();
    
    cardWrappers.forEach(wrapper => {
      const name = wrapper.dataset.name || '';
      const desc = wrapper.dataset.description || '';
      const label = wrapper.dataset.label || '';
      const days = wrapper.dataset.days || '';
      
      const matchesSearch = name.includes(searchTerm) || desc.includes(searchTerm) || label.includes(searchTerm);
      const matchesDay = dayTerm === '' || days.includes(dayTerm);
      
      if (matchesSearch && matchesDay) {
        wrapper.classList.remove('d-none');
      } else {
        wrapper.classList.add('d-none');
      }
    });
  }
  
  searchInput.addEventListener('input', applyFilters);
  dayFilter.addEventListener('change', applyFilters);
});
</script>

<style>
  .transition-hover { transition: transform 0.2s ease, box-shadow 0.2s ease; }
  .transition-hover:hover { transform: translateY(-5px); box-shadow: 0 .75rem 1.5rem rgba(0,0,0,.1)!important; }
  
  .bg-github-handle {
    background-color: #f0f3f6;
    color: #24292e;
    border: 1px solid #d1d5da;
  }
  .bg-github-handle:hover {
    background-color: #e1e4e8;
    color: #0366d6;
  }
  
  .last-child-no-border:last-child { border-bottom: none !important; }
  .last-child-no-margin:last-child { margin-bottom: 0 !important; }
  
  @media (max-width: 767px) {
    .sticky-md-top { position: static !important; }
  }
</style>
{{ end }}
